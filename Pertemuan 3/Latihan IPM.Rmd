---
title: "Latihan IPM"
output: html_document
date: "2025-09-02"
---

# Input Data

```{r}
#input data
library(readxl)
data <- read_excel("C:/Users/LENOVO/Downloads/Data IPM Jabar.xlsx")
data
```

```{r}
library(lmtest) # Untuk Uji Durbin-Watson
library(orcutt) # Untuk metode Cochrane-Orcutt
library(HoRM)   # Untuk metode Hildreth-Lu
```

# Eksplorasi Data

```{r}
#menampilkan struktur data
View(data)
str(data)
```

```{r}
#menampilkan ringkasan statistik data
summary(data)
```

# Membuat Model Awal

```{r}
#melakukan regresi time series 
model_awal <- lm(indeks_pembangunan_manusia ~ tahun, data = data)

summary(model_awal)
```

Dapat terlihat dari output summary bahwa model awal menunjukkan Nilai Adjusted R-squared sangat tinggi (0.9908) dan koefisien tahun sangat signifikan (p-value \< 0.001). Namun, untuk memastikan model ini valid, kita perlu memeriksa apakah ada autokorelasi pada sisaan model.

# Diagnosis Awal

### Diagnosis Visual

```{r}
# Ambil sisaan dari model
sisaan_awal <- residuals(model_awal)

# Plot sisaan terhadap waktu
plot(data$tahun, sisaan_awal, type="o", pch=20, col="red",
     main="Plot Sisaan vs Waktu", xlab="Tahun", ylab="Sisaan")
abline(h=0, lty=2) # Garis referensi di y=0
```

Terdapat kecurigaan :

Berdasarkan plot di atas, terlihat pola yang tidak acak. Sisaan cenderung berkelompok titik pertama di bawah nol, lalu naik ke atas nol, dan turun lagi. Ini adalah gejala visual yang kuat dari autokorelasi positif. Sisaan positif cenderung diikuti sisaan positif, dan sebaliknya.

Diagnosis Formal (Uji Durbin-Watson) H0 (Hipotesis Nol): Tidak ada autokorelasi. Sisaan saling bebas. H1 (Hipotesis Alternatif): Ada autokorelasi.

```{r}
dwtest(model_awal)
```

Hasil Investigasi: Nilai p-value yang dihasilkan sangat kecil yaitu 0.03741, yaitu di bawah tingkat signifikansi 0.05. Sehingga dapat disimpulkan bahwa kita menolak H0 dan bukti sudah kuat dan model terbukti menderita autokorelasi.

## Penanganan Autokorelasi Metode 1: Cochrane-Orcutt

```{r}
model_co <- cochrane.orcutt(model_awal)
summary(model_co)

# rho paling optimum
rho <- model_co$rho
cat("Rho optimum:", rho)
```

Hasil penanganan autokorelasi dengan metode Cochrane-Orcutt menunjukkan bahwa nilai rho yang diperoleh adalah sekitar 0.656. Hal ini menunjukkan adanya autokorelasi positif pada model awal. Kemudian, nilai Durbin-Watson pada model yang telah ditangani adalah sekitar 1.74, yang mendekati 2 dan p-value \>0,05. Ini menunjukkan bahwa autokorelasi telah berhasil diatasi. Selain itu, koefisien **Intercept** dan **Tahun** yang lebih baik

**Verifikasi Manual**

```{r}
indeks_pembangunan_manusia.trans <- data$indeks_pembangunan_manusia[-1] - data$indeks_pembangunan_manusia[-15]*rho

tahun.trans <- data$tahun[-1] - data$tahun[-15]*rho
model_co_manual <- lm(indeks_pembangunan_manusia.trans~tahun.trans)

b0_co_manual <- coef(model_co_manual)[1]/(1-rho)
b1_co_manual <- coef(model_co_manual)[2]
cat("Koefisien manual Cochrane-Orcutt:\n")
cat("b0:", b0_co_manual, "\n")
cat("b1:", b1_co_manual, "\n")
```

Hasil Verifikasi manual menunjukkan hasil yang relatif sama dengan fungsi otomatis.

## Penanganan Autokorelasi Metode 2:  Hidreth-Lu

```{r}
# Hildreth-Lu
hildreth.lu.func<- function(r, model_awal){
  x <- model.matrix(model_awal)[,-1]
  y <- model.response(model.frame(model_awal))
  n <- length(y)
  t <- 2:n
  y <- y[t]-r*y[t-1]
  x <- x[t]-r*x[t-1]
  
  return(lm(y~x))
}

#Pencariab rho yang meminimumkan SSE
r <- c(seq(0.1,0.9, by= 0.1))
tab <- data.frame("rho" = r, "SSE" = sapply(r, function(i){deviance(hildreth.lu.func(i, model))}))
round(tab, 4)
```

Pada hasil di atas terlihat ρminimum ketika 0.7. Namun, hasil tersebut masih kurang teliti sehingga akan dicari kembali ρ yang lebih optimum dengan ketelitian yang lebih. Jika sebelumnya jarak antar ρ yang dicari adalah 0.1, kali ini jarak antar ρ adalah 0.001 dan dilakukan pada selang 0.4 sampai dengan 0.8.

```{r}
#Rho optimal di sekitar 0.4
rOpt <- seq(0.4,0.8, by= 0.001)
tabOpt <- data.frame("rho" = rOpt, "SSE" = sapply(rOpt, function(i){deviance(hildreth.lu.func(i, model))}))
head(tabOpt[order(tabOpt$SSE),])
```

```{r}
#Grafik SSE optimum
par(mfrow = c(1,1))
plot(tab$SSE ~ tab$rho , type = "l", xlab = "Rho", ylab = "SSE")
abline(v = tabOpt[tabOpt$SSE==min(tabOpt$SSE),"rho"], lty = 2, col="red",lwd=2)
text(x=0.341, y=0.2397500, labels = "rho=0.341", cex = 0.8)
```

```{r}
model_hl <- hildreth.lu(data$indeks_pembangunan_manusia, data$tahun, rho = 0.656)
summary(model_hl)
```

```{r}
cat("y = ", coef(model_hl)[1]/(1-0.656), "+", coef(model_hl)[2],"x", sep = "")
```

```{r}
dwtest(model_hl)
```

**Hasil Penanganan Hidreth-Lu**

1.  Berdasarkan plot yang telah dibuat dapat terlihat nila SSE yang paling minimum
2.  Hasil summary menghasilkan akhir yang lebih baik dengan statistik D-W yang lebih baik

# Evaluasi Akhir

```{r}
# Menghitung SSE untuk setiap model secara manual
sse_awal <- sum(residuals(model_awal)^2)
sse_co <- sum(residuals(model_co)^2)
sse_hl <- sum(residuals(model_hl)^2)

# Membuat tabel perbandingan
data.frame(
  Metode = c("Model Awal (Sakit)", "Cochrane-Orcutt (Sehat)", "Hildreth-Lu (Sehat)"),
  SSE = c(sse_awal, sse_co, sse_hl),
  DW_Statistic = c(dwtest(model_awal)$statistic, model_co$DW[3], dwtest(model_hl)$statistic)
)
```

# Kesimpulan Investigasi:

Baik metode Cochrane-Orcutt maupun Hildreth-Lu berhasil menurunkan SSE model, artinya model yang baru lebih akurat.

Keduanya juga berhasil menghilangkan autokorelasi, yang ditunjukkan oleh statistik D-W yang mendekati 2.

Model akhir yang seharusnya kita gunakan adalah salah satu dari model yang telah ditangani, karena estimasi koefisien dan uji signifikansinya sekarang jauh lebih dapat dipercaya.

